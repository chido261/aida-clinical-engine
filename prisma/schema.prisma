generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model UserState {
  id        String   @id // deviceId (NO default demo-user)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // baseline
  baselineA1c        Float?
  baselineAvgGlucose Int?
  baselineSetAt      DateTime?

  // rate limit / uso diario (lo usaremos con FECHA LOCAL MX)
  dailyMsgDate  String?
  dailyMsgCount Int?

  // m√©tricas simples
  totalMsgCount Int      @default(0)
  lastMsgAt     DateTime?

  // trial
  trialStartedAt DateTime?
  trialEndsAt    DateTime?
  licenseStatus  String   @default("trial") // trial | active | expired

  // OTP / licencia (siguiente sprint)
  phoneE164       String?  // +52...
  phoneVerifiedAt DateTime?
}

model Reading {
  id        Int      @id @default(autoincrement())
  userId    String
  glucose   Int
  moment    String
  symptoms  String?
  createdAt DateTime @default(now())
}

model UsageDaily {
  id            Int      @id @default(autoincrement())
  userId        String
  dateLocal     String   // YYYY-MM-DD (America/Mexico_City)
  count         Int      @default(0)
  licenseStatus String   // trial | active
  updatedAt     DateTime @updatedAt

  @@unique([userId, dateLocal])
}